// 获取css变量和值的mixin和functions
// $attr: some custom attribute and html property
// sass-lint:disable no-duplicate-properties
@import './semantic/helper';

// Colors
@function theme-rgb($cat, $attr) {
  $prefix: get-css-prefix();
  $css-var: #{$prefix}-#{get-css-var-name($cat, $attr)};

  @if is-old-theme($cat, $attr) == true {
    $color: get-old-color($cat, $attr);
    $old-css-var: #{$prefix}-#{get-old-css-var($cat, $attr)};

    @return var($css-var, var($old-css-var, $color));
  }

  $color: get-color-value($cat, $attr);

  @return var($css-var, $color);
}

@function theme-rgba($cat, $attr, $opacity) {
  $prefix: get-css-prefix-rgb();
  $css-var: #{$prefix}-#{get-css-var-name($cat, $attr)};

  @if is-old-theme($cat, $attr) == true {
    $color: get-old-color($cat, $attr);
    $old-css-var: #{$prefix}-#{get-old-css-var($cat, $attr)};

    $css-var: var($css-var, var($old-css-var, to-rgb($color)));

    // `unquote` is a workaround for node-sass misinterprets rgba as builtin function
    // https://github.com/sass/node-sass/issues/2251
    // dart-sass doesn't seem to have this issue.
    @return unquote('rgba(#{$css-var}, #{$opacity})');
  }

  $color: get-color-value($cat, $attr);

  @return unquote('rgba(#{var($css-var, to-rgb($color))}, #{$opacity})');
}

@mixin theme-color($prop, $cat, $color-attr, $opacity: 1) {
  $color: get-color($cat, $color-attr);

  @if $opacity >= 1 {
    #{$prop}: $color;
    #{$prop}: theme-rgb($cat, $color-attr);
  } @else {
    #{$prop}: rgba($color, $opacity);
    #{$prop}: theme-rgba($cat, $color-attr, $opacity);
  }
}

@mixin theme-border-impl($prop, $width, $style, $cat, $attr, $opacity) {
  @include theme-color(#{$prop}-color, $cat, $attr, $opacity: 1);

  #{$prop}-width: $width;
  #{$prop}-style: $style;
}

@mixin theme-border($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-top($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-top, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-right($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-right, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-bottom($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-bottom, $width, $style, $cat, $i, $opacity);
}

@mixin theme-border-left($width, $style, $cat, $i, $opacity: 1) {
  @include theme-border-impl(border-left, $width, $style, $cat, $i, $opacity);
}

// Font size
@mixin theme-font-weight($attr) {
  font-weight: map-get($font-weight, $attr);
  font-weight: get-font-weight-var($attr);
}

@mixin theme-font-size($attr) {
  $font-size: map-get($font-size, $attr);
  $font-size-var: get-font-size-var($attr);

  font-size: $font-size;
  font-size: $font-size-var;
  line-height: map-get($line-height, $attr);
  line-height: get-line-height-var($attr);
}

@mixin theme-title-size($attr) {
  @include theme-font-weight(medium);
  @include theme-font-size($attr);
}

@mixin theme-normal-size($attr) {
  @include theme-font-weight(normal);
  @include theme-font-size($attr);
}

@mixin theme-font($attr, $cat) {
  @if $cat == 'title' {
    @include theme-title-size($attr);
  } @else {
    @include theme-normal-size($attr);
  }
}

// Spacing
@mixin theme-spacing($prop, $attr) {
  #{$prop}: map-get($spacing, $attr);
  #{$prop}: get-spacing-var($attr);
}

// Border
@mixin theme-radius($attr: $medium) {
  border-radius: get-border-radius-var($attr);
}

@mixin theme-border-width($prop, $attr: $medium) {
  #{$prop}-width: map-get($border-width, $attr);
  #{$prop}-width: get-border-width-var($attr);
}

// Shadow
$shadow-spec-focus-var: $shadow-size-focus theme-rgba(section, shadow, 0.1) !default;
$shadow-spec-layer-var: $shadow-size-layer theme-rgba(section, shadow, 0.1) !default;
$shadow-spec-modal-var: $shadow-size-modal theme-rgba(section, shadow, 0.1) !default;

$theme-shadow: (
  'focus': $shadow-spec-focus,
  'layer': $shadow-spec-layer,
  'modal': $shadow-spec-modal,
);

$theme-shadow-var: (
  'focus': $shadow-spec-focus-var,
  'layer': $shadow-spec-layer-var,
  'modal': $shadow-spec-modal-var,
);

@mixin theme-shadow($cat) {
  $shadow: map-get($theme-shadow, $cat);
  $shadow-var: map-get($theme-shadow-var, $cat);

  box-shadow: $shadow;
  box-shadow: var(--shadow-spec-#{$cat}, $shadow-var);
}
